---
globs: src/**/*.ts
description: Prisma usage patterns and schema conventions
---

- Import `prisma` from [src/lib/prisma.ts](mdc:src/lib/prisma.ts); never instantiate clients in routes.
- Any route using Prisma must set `export const runtime = 'nodejs'`.
- Schema is in [/prisma/schema.prisma](mdc:/prisma/schema.prisma). Generate with `npm run prisma:generate`; run migrations with `npm run prisma:migrate`.
- Use minimal `select`/`include` for performance; check for `null` from `findUnique`.
- For sensitive actions, also write to `auditLog` with contextual metadata.
- Prefer zod-validated inputs at boundaries and map directly to Prisma data objects.

```ts
import { prisma } from '@/lib/prisma'
export const runtime = 'nodejs'

export async function PUT(req: Request) {
  const data = await req.json()
  const user = await prisma.user.update({ where: { id: data.id }, data })
  return Response.json(user)
}
```
